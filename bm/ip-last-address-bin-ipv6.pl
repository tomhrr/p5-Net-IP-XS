#!/usr/bin/perl

use warnings;
use strict;

use Net::IP;
use Net::IP::XS;

my @entries = (
    ['00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000', 0, 6],
    ['00000000000000000000000000000001000000000000000000000000000000010000000000000000000000000000000100000000000000000000000000000001', 1, 6],
    ['00000000000001000000000100000001000000000000010000000001000000010000000000000100000000010000000100000000000001000000000100000001', 16, 6],
    ['00001000000001000000100100010001000010000000010000001001000100010000100000000100000010010001000100001000000001000000100100010001', 32, 6],
    ['10000000000000001000000000000000100000000000000010000000000000001000000000000000100000000000000010000000000000001000000000000000', 64, 6],
    ['10000000100000001000000001000000100000001000000010000000010000001000000010000000100000000100000010000000100000001000000001000000', 96, 6],
    ['10000000000000000000000000000000100000000000000000000000000000001000000000000000000000000000000010000000000000000000000000000000', 64, 6],
    ['01010101001001001001001001001001010101010010010010010010010010010101010100100100100100100100100101010101001001001001001001001001', 12, 6],
    ['11010111101101001011111001001101110101111011010010111110010011011101011110110100101111100100110111010111101101001011111001001101', 10, 6],
    ['11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111', 128, 6],
);

my ($type, $count) = @ARGV;
$count ||= 200000;

if ($type eq 'net-ip') {
    for (1..$count) {
        for my $entry (@entries) {
            my ($binstr, $len, $version) = @{$entry};
            Net::IP::ip_last_address_bin($binstr, $len, $version);
        }
    }
} elsif ($type eq 'net-ip-xs') {
    for (1..$count) {
        for my $entry (@entries) {
            my ($binstr, $len, $version) = @{$entry};
            Net::IP::XS::ip_last_address_bin($binstr, $len, $version);
        }
    }
} else {
    die "invalid type $type";
}

1;
